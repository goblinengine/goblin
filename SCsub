#!/usr/bin/env python
from misc.utility.scons_hints import *

import os
import goblin_builders
import methods

Import("env")

# Create goblin environment (clone from main env)
env_goblin = env.Clone()
env_goblin.goblin_sources = []

goblin_module_path = Dir(".").abspath

# ===================================================================
# REBRANDING APPROACH - BUILDER MONKEY-PATCHING
# The builders are replaced in config.py before core/main SCsub runs.
# This SCsub just needs to build our custom goblin classes.
# ===================================================================

# Export environment for sub-SCsubs
Export("env_goblin")

# Build subdirectories (mirrors Godot's structure)
if os.path.exists(goblin_module_path + "/core/SCsub"):
    SConscript("core/SCsub")

if env.editor_build and os.path.exists(goblin_module_path + "/editor/SCsub"):
    SConscript("editor/SCsub")

# Add module registration
env_goblin.add_source_files(env_goblin.goblin_sources, "*.cpp")

# Add all goblin sources to main modules sources
env.modules_sources += env_goblin.goblin_sources

print("Goblin Engine: Complete rebranding applied")
